data <- matrix(rnorm(20), nrow = 5, ncol = 4)
colnames(data) <- c("Full", "Condition1", "Condition2", "Condition3")
rownames(data) <- paste0("Gene", 1:5)
# Compute the difference matrix for clustering
reference <- data[, "Full"]
difference_matrix <- sweep(data, MARGIN = 1, STATS = reference, FUN = "-")
# Compute hierarchical clustering based on the difference matrix
row_dist <- dist(difference_matrix) # Row distances
row_clust <- hclust(row_dist)       # Row clustering
col_dist <- dist(t(difference_matrix)) # Column distances
col_clust <- hclust(col_dist)          # Column clustering
# Plot heatmap with original values but using custom clustering
heatmap(
data,
Rowv = as.dendrogram(row_clust),  # Row clustering from difference matrix
Colv = as.dendrogram(col_clust),  # Column clustering from difference matrix
scale = "none",
main = "Heatmap with Original Values and Custom Clustering"
)
reference
#diff_data <- diff_data[, colnames(diff_data) != reference_col]
# Remove the reference column
reference <- t[, "Full"]
reference
difference_matrix <- sweep(t, MARGIN = 1, STATS = reference, FUN = "-")
row_dist <- dist(difference_matrix) # Row distances
row_dist
row_clust <- hclust(row_dist)       # Row clustering
col_dist <- dist(t(difference_matrix)) # Column distances
col_clust <- hclust(col_dist)
# Create a heatmap with custom clustering
heatmap(
t,
Rowv = as.dendrogram(row_clust),  # Row clustering from difference matrix
Colv = as.dendrogram(col_clust),  # Column clustering from difference matrix
scale = "none",
main = "Heatmap with Original Values and Custom Clustering"
)
t
typeof(t)
class(t)
# Create a heatmap with custom clustering
t<- as.matrix(t)
colnames(t)
rownames(t)
heatmap(
t,
Rowv = as.dendrogram(row_clust),  # Row clustering from difference matrix
Colv = as.dendrogram(col_clust),  # Column clustering from difference matrix
scale = "none",
main = "Heatmap with Original Values and Custom Clustering"
)
vars<- rowVars(normalized_counts)
rm(list = ls())
conditions<- list(
Full_CD8_V7 = 57:60,
dualCAR_CD8_V7 = 37:40,
CD3only_CD8_V7 = 1:4,
Costimonly_CD8_V7 = 25:28,
fulldel_CD8_V7 = 81:84,
Full_CD8_killing_V7 = 69:72,
Full_CD8_killing = 65:68,
Full_CD4_V7 = 13:16,
Full_CD8_monomer = 73:76,
dualCAR_CD8_monomer = 49:52,
CD3only_CD8_monomer = 9:12,
Costimonly_CD8_monomer = 33:36,
fulldel_CD8_monomer = 88:92,
Full_CD4_monomer = 21:24,
Full_CD8_Mb_wtIL2 = 53:56,
dualCAR_CD8_V9_Mb = 41:44,
Full_CD8_wtIL2 = 77:80,
Full_CD8_control = 61:64,
dualCAR_CD8_control = 45:48,
CD3only_CD8_control = 5:8,
Costimonly_CD8_control = 29:32,
fulldel_CD8_control = 85:88,
Full_CD4_control = 17:20
)
batches<- list(
Full_CD8_V7="1",
dualCAR_CD8_V7 = "2",
CD3only_CD8_V7 = "2",
Costimonly_CD8_V7 = "2",
fulldel_CD8_V7 = "1",
Full_CD8_killing_V7 = "1",
Full_CD8_killing = "1",
Full_CD4_V7 = "1",
Full_CD8_monomer = "1",
dualCAR_CD8_monomer = "1",
CD3only_CD8_monomer = "2",
Costimonly_CD8_monomer = "2",
fulldel_CD8_monomer = "2",
Full_CD4_monomer = "1",
Full_CD8_Mb_wtIL2 = "1",
dualCAR_CD8_V9_Mb = "2",
Full_CD8_wtIL2 = "1",
Full_CD8_control = "1",
dualCAR_CD8_control = "2",
CD3only_CD8_control = "2",
Costimonly_CD8_control = "1",
fulldel_CD8_control = "2",
Full_CD4_control = "1"
)
setwd("/Volumes/My_Passport/paper2_result/new_pipeline/")
getwd()
data<- read.table("/Volumes/My_Passport/paper2_result/new_pipeline/countMatrix_all.txt")
geneIDs<- data$Geneid
gene_IDs <- read.table("/Volumes/My_Passport/paper2_result/new_pipeline/Ensemble_IDs.txt", header = T , fill = T)
gene_IDs[gene_IDs==""]<-NA
colnames(gene_IDs) <- c("ensembl_gene_id", "hgnc_symbol")
data$Geneid<- NULL
rownames(data)<- geneIDs
colnames(data)<- unlist(map(strsplit(colnames(data), split = "_CKD"), 1))
data<- data[complete.cases(data),]
geneIDs<- rownames(data)
data <- data %>%
rownames_to_column(var = "ensembl_gene_id")
data <- data %>%
left_join(gene_IDs, by = "ensembl_gene_id")
data$hgnc_symbol[data$hgnc_symbol==""]<-NA
data<- data[complete.cases(data), ]
ind.dup<- which(duplicated(data$hgnc_symbol))
if (length(ind.dup)>0)
{
data<- data[-ind.dup,]
}
Genes<- data$hgnc_symbol
ENSEMBLE<-data$ensembl_gene_id
data$ensembl_gene_id<-NULL
rownames(data)<- Genes
data$hgnc_symbol<-NULL
Trx<- conditions[[i]]
Ctrl<- conditions[[j]]
Ctrl2<- conditions[[k]] ## remove
Ctrl3<- conditions[[l]] ## remove
i=1
j=3
k=4
l=5
Trx<- conditions[[i]]
Ctrl<- conditions[[j]]
Ctrl2<- conditions[[k]] ## remove
Ctrl3<- conditions[[l]] ## remove
group1<- names(conditions)[i]
group2<- names(conditions)[j]
group3<- names(conditions)[k]# remove
group4<- names(conditions)[l]# remove
# filter data
data_files<- data[,c(Trx , Ctrl, Ctrl2 , Ctrl3)]
colnames(data_files)
# make direction
#dir_name <- paste0(group1, "_vs_", group2)
dir_name<- "fig6"
dir.create(dir_name, showWarnings = FALSE)
dir.create(dir_name, showWarnings = FALSE)
# create meta data for desq2
meta<- matrix("", nrow = ncol(data_files) , ncol=1)
colnames(meta)<- c("sample_type" )
meta<- as.data.frame(meta)
sample_names<- colnames(data_files)
rownames(meta)<- sample_names
meta<- as.data.frame(meta)
meta[,1]<- substr(rownames(meta) , 1 , nchar(rownames(meta))-2 )
# meta$samplenames<- c(paste0(group1, "_" , 1:length(Trx)) , paste0(group2, "_" , 1:length(Ctrl))) ## add to code
meta$samplenames<- rownames(meta)
#meta$Batch<- c( rep(batches$Full_CD8_V7 , 4) , rep(batches$dualCAR_CD8_V7 , 4) )
meta
data_files<-data_files%>%rownames_to_column(var="SYMBOL")
rownames(data_files)<- data_files$SYMBOL
# data_files<- data_files%>%left_join(gene_IDs , by="ensembl_gene_id")
# data_files$hgnc_symbol[data_files$hgnc_symbol==""]<-NA
# data_files<- data_files[complete.cases(data_files),]
# dup.id<- which(duplicated(data_files$ensembl_gene_id))
# if(length(dup.id) >0)
#   data_files<- data_files[-dup.id, ]
# rownames(data_files)<- data_files$ensembl_gene_id
#data_files$ensembl_gene_id<-NULL
data_files$SYMBOL<-NULL
# deseq with rlog
dds <- DESeqDataSetFromMatrix(data_files, meta, design = ~ sample_type)
dds <- estimateSizeFactors(dds)
normalized_counts <- counts(dds, normalized=TRUE)
vars<- rowVars(normalized_counts)
sorted_dat<- normalized_counts[order(rowVars(normalized_counts) , decreasing = T), ]
selected_dat<- sorted_dat[1:50, ]
selected_genes<- rownames(selected_dat)
selected_dat<- log10(selected_dat)
selected_dat[is.infinite(selected_dat)]<-NA
selected_dat<- selected_dat[complete.cases(selected_dat), ]
pheatmap(selected_dat , fontsize = 6 )
# Transform the data relative to the reference column ("Full")
reference_col <- "Full"
diff_data <- sweep(selected_dat, 1, selected_dat[, reference_col], FUN = "-")  # Subtract the reference
rm (list = ls())
# make the data frame of LFCs
control<- rev(c("Full_CD8_control","CD3only_CD8_control", "Costimonly_CD8_control", "fulldel_CD8_control"))
sample_names<- rev(c("Full_CD8_V7","CD3only_CD8_V7", "Costimonly_CD8_V7", "fulldel_CD8_V7"))
# make the data frame of LFCs
control<- rev(c("Full_CD8_control","CD3only_CD8_control", "Costimonly_CD8_control", "fulldel_CD8_control"))
sample_names<- rev(c("Full_CD8_V7","CD3only_CD8_V7", "Costimonly_CD8_V7", "fulldel_CD8_V7"))
files_names<- paste0(sample_names, "_vs_",control )
# make the data frame of LFCs
control<- rev(c("Full_CD8_control","CD3only_CD8_control", "Costimonly_CD8_control", "fulldel_CD8_control"))
sample_names<- rev(c("Full_CD8_V7","CD3only_CD8_V7", "Costimonly_CD8_V7", "fulldel_CD8_V7"))
files_names<- paste0(sample_names, "_vs_",control )
list_files<-as.list(paste0("/Volumes/My_Passport/paper2_result/new_pipeline/" , files_names, "/res_lfc_", files_names , ".txt"))
x_list <- lapply(list_files, read.delim)
x <- lapply(x_list, function(file) {
subset(file, Symbol %in% Genes)[, c("log2FoldChange", "Symbol"), drop = FALSE]
})
x <- lapply(x_list, function(file) {
subset(file, Symbol)[, c("log2FoldChange", "Symbol"), drop = FALSE]
})
x <- lapply(x_list, function(file) {
file[, c("log2FoldChange", "Symbol"), drop = FALSE]
})
View(x)
names(x)
files_names
names(x)<- files_names
merged_df <- x[[1]]
colnames(merged_df)[colnames(merged_df) == "log2FoldChange"] <- names(x)[1]
# Iteratively merge the remaining data frames on 'Symbol'
for (i in 2:length(x)) {
current_df <- x[[i]]
colnames(current_df)[colnames(current_df) == "log2FoldChange"] <- names(x)[i]
merged_df <- merge(merged_df, current_df, by = "Symbol", all = TRUE)
}
View(merged_df)
# Result
dim(merged_df)
rownames(merged_df)<- merged_df$Symbol
merged_df$Symbol<-NULL
merged_df<- merged_df[complete.cases(merged_df), ]
merged_df.var<-merged_df[order(rowVars(merged_df) , decreasing = T), ]
order(rowVars(merged_df) , decreasing = T)
merged_df<- as.numeric(merged_df)
merged_df<- as.matrix(merged_df)
merged_df<- as.numeric(merged_df)
rownames(merged_df)
merged_df <- x[[1]]
colnames(merged_df)[colnames(merged_df) == "log2FoldChange"] <- names(x)[1]
# Iteratively merge the remaining data frames on 'Symbol'
for (i in 2:length(x)) {
current_df <- x[[i]]
colnames(current_df)[colnames(current_df) == "log2FoldChange"] <- names(x)[i]
merged_df <- merge(merged_df, current_df, by = "Symbol", all = TRUE)
}
# Result
dim(merged_df)
rownames(merged_df)<- merged_df$Symbol
merged_df$Symbol<-NULL
merged_df<- merged_df[complete.cases(merged_df), ]
merged_df<- as.matrix(merged_df)
typeof(merged_df)
merged_df.var<-merged_df[order(rowVars(merged_df) , decreasing = T), ]
View(merged_df)
TopGenes<- rownames(merged_df.var)[1:250]
final_table<- merged_df.var[1:250, ]
colnames(final_table)<- rev(c("Full", "CD3_only", "4-1BBonly", "fulldel"))
t<- final_table
setwd("fig6/")
write.csv(final_table ,paste0(fig_name, ".csv") , quote = F)
fig_name<- "fig6"
# removing outliers
t[t > 20] <- NA
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
colnames(merged_df.var)
merged_df.var<-merged_df[order(merged_df.var[, 4], decreasing = T), ]
TopGenes<- rownames(merged_df.var)[1:250]
final_table<- merged_df.var[1:250, ]
colnames(final_table)<- rev(c("Full", "CD3_only", "4-1BBonly", "fulldel"))
t<- final_table
setwd("fig6/")
write.csv(final_table ,paste0(fig_name, ".csv") , quote = F)
# removing outliers
t[t > 20] <- NA
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
dim(t)
t<- t[1:100, ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
View(merged_df.var)
merged_df.var<-merged_df[order(merged_df.var[, 4], decreasing = T), ]
final_table<- merged_df.var[1:250, ]
colnames(final_table)<- rev(c("Full", "CD3_only", "4-1BBonly", "fulldel"))
t<- final_table
setwd("fig6/")
write.csv(final_table ,paste0(fig_name, ".csv") , quote = F)
# removing outliers
t[t > 20] <- NA
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
#, breaks = ph.breaks , color =ph.cols
final_table[final_table<= -10]<-NA
final_table<- final_table[complete.cases(final_table), ]
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
t<- final_table
setwd("fig6/")
write.csv(final_table ,paste0(fig_name, ".csv") , quote = F)
# removing outliers
t[t > 20] <- NA
t[t< -10]<- NA
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
final_table<- final_table[1:100, ]
t<- final_table
setwd("fig6/")
write.csv(final_table ,paste0(fig_name, ".csv") , quote = F)
# removing outliers
t[t > 20] <- NA
t[t< -10]<- NA
# myBreaks<- c(-4, -2, 4, 10)
#ph.breaks <- seq(from = -10, to = 10, length.out = 201)
ph.breaks <- seq(from = -1, to = 13, length.out = 101)
pdf(paste0(fig_name , "_withLFC_Supp.pdf"), width = 4 , height = 20)
#par(mar=c(20,20,20,20))
print(pheatmap(t , cluster_cols = T , show_colnames = T,
fontsize_row = 15 , fontsize_col = 15 , cluster_rows = T, fontsize = 15 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey" ))
dev.off()
graphics.off()
t <- t[complete.cases(t), ]
ph.cols <- colorRampPalette(rev(brewer.pal(n = 7, name = "RdYlBu")))(100)
# pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 4.5 , height = 15.5)
pdf(paste0(fig_name , "_withLFC_main.pdf"), width = 45 , height = 155)
print(pheatmap(t, cluster_cols = T , show_colnames = T,
fontsize_row = 21.5 , fontsize_col = 20 , cluster_rows = T, fontsize = 20 , legend = T
, annotation_legend = T , angle_col = 315 , na_col="grey"   ) )
dev.off()
graphics.off()
getwd()
getwd()
getwd()
report_beta<- function<- (r, NAME){
report_beta<- function(r, NAME){
g_<- makeGRangesFromDataFrame(r ,keep.extra.columns=T)
average_percent<- findOverlaps(g_r, g_df ) %>% as.data.frame()%>%mutate(percent=g_df$percent[subjectHits])%>%
group_by(queryHits)%>% summarize(average_percent= mean(percent , na.rm=T))
r<- r%>%
mutate(average_percent = NA) %>% mutate(names= as.numeric(rownames(r)))%>%
left_join(average_percent, by = c("names" = "queryHits")) %>%
mutate(average_percent = average_percent.y ) %>%
select(-average_percent.x, -average_percent.y , -names)
write.table(r , paste0(s , "/beta_",NAME,".txt") , quote=F , sep="\t" , row.names=F)
}
getwd()
mkdir test
getwd()
setwd("test")
getwd()
BiocManager::install("karyoploteR")
library(karyoploteR)
?createRandomRegions
regions <- createRandomRegions(nregions=10000, length.mean = 1e6, mask=NA, non.overlapping=FALSE)
class(regions)
typeof(regions)
?makeGRangesFromDataFrame
??str_detect
?pdf
getwd()
setwd("/Volumes/My_Passport/fragmentomics")
list_freq<-list.files(path="results", pattern = "*/smoothed/txt")
list_freq
list_freq<-list.files(path="results", pattern = "*/smoothed.txt")
list_freq
list_freq<-list.files(path="results", pattern = "smoothed\\.txt$",
recursive = TRUE,
full.names = TRUE)
list_freq
freq_list<- lapply(files, read.table)
files<-list.files(path="results", pattern = "smoothed\\.txt$",
recursive = TRUE,
full.names = TRUE)
freq_list<- lapply(files, read.table)
freq_list
x<- list_freq
x<- list_freq[[1]]
x<- freq_list[[1]]
min(x$V1)
freq_list<- lapply(files, read.table, header = TRUE)
x<- freq_list[[1]]
x
min(x)
min(x$length)
max(x$length)
354-2+1
dim(x)
sample_file<- "data/sample_files.txt"
samples <- read.table(
sample_file,
header = FALSE,
col.names = c("sample", "group")
)
samples
df_list <- lapply(seq_len(nrow(samples)), function(i) {
s <- samples$sample[i]
g <- samples$group[i]
f <- file.path("results", s, "smoothed.txt")
dat <- read.table(f, header = TRUE)
dat$sample <- s
dat$group  <- g
dat
})
samples<- samples[1,]
df_list <- lapply(seq_len(nrow(samples)), function(i) {
s <- samples$sample[i]
g <- samples$group[i]
f <- file.path("results", s, "smoothed.txt")
dat <- read.table(f, header = TRUE)
dat$sample <- s
dat$group  <- g
dat
})
df_list
